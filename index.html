<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ForCons</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body { font-family: 'Inter', sans-serif; }
        .page { display: none; animation: fadeIn 0.5s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background-color: white; border-radius: 0.75rem; padding: 1.5rem; box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .btn-primary { background-color: #4f46e5; color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; transition: background-color 0.3s, transform 0.2s; text-align: center; border: none; cursor: pointer; }
        .btn-primary:hover { background-color: #4338ca; transform: scale(1.02); }
        .btn-success { background-color: #16a34a; } .btn-success:hover { background-color: #15803d; }
        .btn-danger { background-color: #dc2626; } .btn-danger:hover { background-color: #b91c1c; }
        .btn-whatsapp { background-color: #25D366; color: white; }
        .btn-whatsapp:hover { background-color: #128C7E; }
        .modal { animation: modalFadeIn 0.3s ease; }
        @keyframes modalFadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        #toast-notification { transition: transform 0.5s ease-in-out, opacity 0.5s ease-in-out; transform: translateY(100%); opacity: 0; }
        #toast-notification.show { transform: translateY(0); opacity: 1; }
        .chat-box::-webkit-scrollbar { width: 6px; }
        .chat-box::-webkit-scrollbar-track { background: #f1f1f1; }
        .chat-box::-webkit-scrollbar-thumb { background: #a5b4fc; border-radius: 6px; }
        [data-state="closed"] > div { display: none; }
        .prose { max-width: 65ch; } .prose h3 { font-size: 1.25em; font-weight: 700; margin-top: 1.5em; margin-bottom: 0.5em; } .prose p { line-height: 1.7; margin-bottom: 1em; } .prose ul { list-style-type: disc; margin-left: 1.5em; margin-bottom: 1em; } .prose li { margin-bottom: 0.5em; } .prose .percentage-box { background-color: #eef2ff; border-left: 4px solid #4f46e5; padding: 1rem; margin: 1.5rem 0; border-radius: 0.25rem; } .prose .percentage-box p { margin: 0; font-weight: 500; }
        #app-container::-webkit-scrollbar { width: 8px; }
        #app-container::-webkit-scrollbar-track { background: #f1f5f9; }
        #app-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        #app-container::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div id="app-container" class="w-full h-full overflow-y-auto"></div>

    <div id="form-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden modal">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl" onclick="event.stopPropagation()">
            <div class="p-4 border-b flex justify-between items-center"><h3 id="modal-form-title" class="text-xl font-bold text-slate-800"></h3><button onclick="closeFormModal()" class="text-slate-400 hover:text-slate-800"><i data-lucide="x" class="h-6 w-6"></i></button></div>
            <div id="modal-body" class="p-6 max-h-[70vh] overflow-y-auto"><form id="modal-form-content"></form></div>
        </div>
    </div>

    <div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 hidden modal">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6 text-center">
            <i data-lucide="alert-triangle" class="h-12 w-12 mx-auto text-red-500"></i>
            <h3 id="confirm-modal-title" class="text-lg font-bold mt-4"></h3>
            <p id="confirm-modal-message" class="my-2 text-slate-600 text-sm"></p>
            <div class="flex justify-center gap-4 mt-6">
                <button id="confirm-modal-cancel" class="bg-slate-200 hover:bg-slate-300 text-slate-800 font-bold py-2 px-6 rounded-lg">Batal</button>
                <button id="confirm-modal-confirm" class="btn-primary btn-danger py-2 px-6">Ya, Lanjutkan</button>
            </div>
        </div>
    </div>
    
    <div id="toast-notification" class="fixed bottom-5 right-5 bg-slate-800 text-white py-3 px-5 rounded-lg shadow-lg"><p id="toast-message"></p></div>

    <script>
        // === INITIAL STATE & MOCK DATA ===
        let activePage = 'login-page';
        let currentUser = null;
        let currentEditingId = null;

        const mockData = {
            users: [
                { username: 'adifamelaniputri', password: '12348', testResults: {}, appointments: [] }, { username: 'anastasyazajuli', password: '12348', testResults: {}, appointments: [] },
                { username: 'andiniputriprasetyo', password: '12348', testResults: {}, appointments: [] }, { username: 'annisasetiawan', password: '12348', testResults: {}, appointments: [] },
                { username: 'aurazahrani', password: '12348', testResults: {}, appointments: [] }, { username: 'aurelliarahman', password: '12348', testResults: {}, appointments: [] },
                { username: 'cantikapujiarti', password: '12348', testResults: {}, appointments: [] }, { username: 'darriellriyadi', password: '12348', testResults: {}, appointments: [] },
                { username: 'fazlemawlaakhtarsopian', password: '12348', testResults: {}, appointments: [] }, { username: 'fitriyani', password: '12348', testResults: {}, appointments: [] },
                { username: 'galangrizkysadaya', password: '12348', testResults: {}, appointments: [] }, { username: 'indiraarpiana', password: '12348', testResults: {}, appointments: [] },
                { username: 'irfanhafizhrizoullah', password: '12348', testResults: {}, appointments: [] }, { username: 'kalilaazhara', password: '12348', testResults: {}, appointments: [] },
                { username: 'kaniyajuliautami', password: '12348', testResults: {}, appointments: [] }, { username: 'kautsarhidayatullah', password: '12348', testResults: {}, appointments: [] },
                { username: 'mikaalghanijasin', password: '12348', testResults: {}, appointments: [] }, { username: 'muhamadfaridramadhan', password: '12348', testResults: {}, appointments: [] },
                { username: 'muhamadlanggiyuripradipta', password: '12348', testResults: {}, appointments: [] }, { username: 'muhammadaddarouthni', password: '12348', testResults: {}, appointments: [] },
                { username: 'muhammadawaabdurrohman', password: '12348', testResults: {}, appointments: [] }, { username: 'nadiraindriani', password: '12348', testResults: {}, appointments: [] },
                { username: 'niaputriramadhani', password: '12348', testResults: {}, appointments: [] }, { username: 'putrialysakeyla', password: '12348', testResults: {}, appointments: [] },
                { username: 'radityagunawan', password: '12348', testResults: {}, appointments: [] }, { username: 'raiddhaylajabar', password: '12348', testResults: {}, appointments: [] },
                { username: 'rafiahmadalgibran', password: '12348', testResults: {}, appointments: [] }, { username: 'rainamairahermawan', password: '12348', testResults: {}, appointments: [] },
                { username: 'raisyaariyanti', password: '12348', testResults: {}, appointments: [] }, { username: 'razipadipratama', password: '12348', testResults: {}, appointments: [] },
                { username: 'rindusalsabila', password: '12348', testResults: {}, appointments: [] }, { username: 'rubianaazzahra', password: '12348', testResults: {}, appointments: [] },
                { username: 'shintarahayupertiwisujai', password: '12348', testResults: {}, appointments: [] }, { username: 'sitialiftaazzahrakhumairoh', password: '12348', testResults: {}, appointments: [] },
                { username: 'sulthanrifoighibransyah', password: '12348', testResults: {}, appointments: [] }, { username: 'tiaradwiramadhani', password: '12348', testResults: {}, appointments: [] }
            ],
            admins: [{ username: 'admin.rohman', password: 'bk.gofar2025' }],
            superAdminCredentials: { username: 'superadmin', password: 'forcons2025' },
            articles: [
                { id: 1, title: '5 Cara Menemukan Passion Sejak Dini', content: 'Menemukan passion adalah kunci untuk karier yang memuaskan. Ini adalah perjalanan penemuan diri...', fullContent: `<div class="prose"><h3>1. Eksplorasi Berbagai Bidang</h3><p>Jangan batasi diri Anda pada satu atau dua kegiatan saja. Coba hal-hal baru yang belum pernah Anda lakukan sebelumnya, seperti coding, melukis, menjadi sukarelawan, atau belajar alat musik. Semakin banyak pengalaman yang Anda miliki, semakin besar kemungkinan Anda menemukan sesuatu yang benar-benar Anda nikmati.</p><h3>2. Perhatikan "Flow State" Anda</h3><p>Flow state adalah kondisi di mana Anda begitu tenggelam dalam suatu aktivitas sehingga waktu terasa berjalan cepat. Perhatikan kapan Anda mengalami ini. Apakah saat memecahkan masalah matematika yang rumit? Atau saat merancang sebuah presentasi? Aktivitas yang membawa Anda ke dalam flow state seringkali merupakan petunjuk kuat menuju passion Anda.</p><h3>3. Tanyakan pada Diri Sendiri: Apa Masalah yang Ingin Anda Selesaikan?</h3><p>Passion seringkali terkait dengan keinginan untuk memberikan dampak. Pikirkan tentang masalah di dunia atau di komunitas Anda yang paling membuat Anda peduli. Mungkin Anda ingin membantu mengatasi perubahan iklim, meningkatkan literasi, atau menciptakan teknologi yang memudahkan hidup orang. Tujuan ini bisa menjadi bahan bakar passion Anda.</p><h3>4. Jangan Takut Gagal</h3><p>Dalam proses eksplorasi, Anda pasti akan menemukan hal-hal yang tidak Anda sukai, dan itu tidak apa-apa. Setiap "kegagalan" atau "ketidaksukaan" adalah data berharga yang membantu Anda mempersempit pencarian. Anggaplah ini sebagai proses eliminasi yang membawa Anda lebih dekat ke tujuan.</p><h3>5. Bicaralah dengan Banyak Orang</h3><p>Wawancarai orang-orang dari berbagai profesi. Tanyakan apa yang mereka sukai dan tidak sukai dari pekerjaan mereka, bagaimana mereka memulai, dan apa tantangan terbesarnya. Mendengar perspektif orang lain dapat membuka mata Anda terhadap jalur karier yang mungkin belum pernah Anda pertimbangkan sebelumnya.</p></div>` },
                { id: 2, title: 'Manajemen Waktu Efektif untuk Pelajar', content: 'Sebagai pelajar, waktu adalah aset berharga. Kuasai manajemen waktu untuk menyeimbangkan...', fullContent: `<div class="prose"><h3>1. Gunakan Matriks Eisenhower</h3><p>Bagi tugas Anda ke dalam empat kuadran: Penting & Mendesak (lakukan sekarang), Penting & Tidak Mendesak (jadwalkan), Tidak Penting & Mendesak (delegasikan jika bisa), dan Tidak Penting & Tidak Mendesak (eliminasi). Ini membantu Anda fokus pada apa yang benar-benar penting untuk tujuan jangka panjang Anda, bukan hanya yang paling berisik.</p><h3>2. Teknik Pomodoro</h3><p>Teknik ini sangat sederhana namun efektif. Atur timer selama 25 menit dan fokuslah sepenuhnya pada satu tugas. Setelah 25 menit, ambil istirahat 5 menit. Setelah empat sesi "Pomodoro", ambil istirahat lebih lama (15-30 menit). Ini membantu menjaga konsentrasi dan mencegah kelelahan mental.</p><h3>3. Buat Rencana Mingguan dan Harian</h3><p>Pada hari Minggu malam, luangkan waktu 30 menit untuk merencanakan minggu Anda. Tentukan prioritas utama Anda. Kemudian, setiap malam, luangkan 10 menit untuk merencanakan hari berikutnya secara lebih detail. Ini akan membuat Anda memulai hari dengan tujuan yang jelas.</p><h3>4. Atasi Penundaan dengan Aturan 2 Menit</h3><p>Jika sebuah tugas membutuhkan waktu kurang dari dua menit untuk diselesaikan, lakukan segera. Jangan ditunda. Untuk tugas yang lebih besar, gunakan aturan ini untuk memulainya. Misalnya, "Saya hanya akan membaca satu halaman buku" atau "Saya hanya akan menulis satu paragraf esai". Seringkali, memulai adalah bagian tersulit.</p><h3>5. Lindungi Waktu Fokus Anda</h3><p>Identifikasi waktu di mana Anda paling produktif (misalnya, pagi hari). Jadikan waktu ini sakral. Matikan notifikasi di ponsel Anda, tutup tab media sosial, dan beri tahu keluarga atau teman bahwa Anda tidak ingin diganggu. Satu jam kerja tanpa gangguan jauh lebih produktif daripada tiga jam kerja dengan banyak interupsi.</p></div>` },
                { id: 3, title: 'Pentingnya Kegagalan dalam Proses Belajar', content: 'Banyak yang takut gagal, padahal kegagalan adalah guru terbaik dalam perjalanan menuju sukses...', fullContent: `<div class="prose"><p>Dalam budaya yang seringkali hanya merayakan kesuksesan, kegagalan dianggap sebagai sesuatu yang memalukan dan harus dihindari. Padahal, para inovator, ilmuwan, dan seniman terbesar dalam sejarah semuanya sepakat akan satu hal: kegagalan adalah bagian tak terpisahkan dari proses belajar dan pencapaian. Ketika Anda gagal, Anda mendapatkan umpan balik yang paling jujur tentang apa yang tidak berhasil. Ini memaksa Anda untuk menganalisis, beradaptasi, dan mencoba pendekatan baru. Kegagalan membangun ketangguhan mental (resilience), mengajarkan kerendahan hati, dan memicu kreativitas dengan mendorong Anda keluar dari jalur yang biasa. Jadi, daripada takut gagal, ubahlah cara pandang Anda. Lihatlah kegagalan bukan sebagai akhir dari jalan, tetapi sebagai penunjuk arah yang berharga menuju jalan yang benar.</p></div>` }
            ],
            events: [ { id: 1, title: 'Campus Expo 2025', date: '2025-10-25', location: 'Jakarta Convention Center', description: 'Pameran pendidikan tinggi terbesar diikuti oleh universitas ternama.', registrants: [] } ],
            chatMessages: [ { id: 1, sender: 'admin', text: 'Selamat datang di layanan konseling! Ada yang bisa saya bantu?', timestamp: new Date(Date.now() - 300000), read: true }, { id: 2, sender: 'siswa', text: 'Halo, Bu/Pak. Saya masih bingung antara memilih jurusan IPA atau IPS di SMA.', timestamp: new Date(Date.now() - 240000), read: false } ],
            appointments: [ { id: 1, student: 'budi', date: '2025-10-05', time: '10:00', topic: 'Konsultasi Jurusan Kuliah', status: 'pending', createdAt: new Date(Date.now() - 86400000) } ],
            materiKonsultasi: [
                { id: 1, title: "Mengatasi Stres dan Kecemasan Belajar", summary: "Kenali penyebab stres dan pelajari teknik relaksasi...", content: "Stres saat belajar adalah hal yang wajar... (konten sama)" },
                { id: 2, title: "Membangun Kepercayaan Diri di Sekolah", summary: "Kepercayaan diri adalah kunci untuk berprestasi...", content: "Kepercayaan diri bukan bakat, tapi keterampilan... (konten sama)" },
                { id: 3, title: "Cara Belajar Efektif: Teknik Feynman", summary: "Ubah materi rumit menjadi sederhana dengan metode ini...", content: `<div class="prose"><h3>Apa itu Teknik Feynman?</h3><p>Dikembangkan oleh fisikawan pemenang Nobel, Richard Feynman, teknik ini adalah metode belajar yang berfokus pada pemahaman mendalam dengan cara menyederhanakan konsep. Intinya: jika Anda tidak bisa menjelaskan sesuatu dengan sederhana, Anda belum benar-benar memahaminya.</p><h3>Langkah-langkahnya:</h3><ul><li><strong>Pilih Sebuah Konsep:</strong> Ambil topik yang ingin Anda pelajari.</li><li><strong>Ajarkan kepada Anak Kecil:</strong> Bayangkan Anda sedang menjelaskannya kepada siswa kelas 5. Tulis penjelasan Anda menggunakan bahasa yang sangat sederhana dan analogi yang mudah dimengerti. Hindari jargon teknis.</li><li><strong>Identifikasi Celah Pengetahuan:</strong> Saat menulis penjelasan, Anda akan menemukan bagian mana yang Anda sendiri masih ragu atau tidak bisa menjelaskannya dengan lancar. Ini adalah celah dalam pemahaman Anda.</li><li><strong>Kembali ke Sumber & Sederhanakan:</strong> Buka kembali buku atau materi sumber Anda untuk mengisi celah tersebut. Ulangi proses penyederhanaan hingga Anda bisa menjelaskan keseluruhan konsep dengan lancar dan sederhana.</li></ul></div>` },
                { id: 4, title: "Kecerdasan Emosional (EQ) di Sekolah", summary: "Mengapa EQ sama pentingnya dengan IQ untuk sukses...", content: `<div class="prose"><p>Kecerdasan Emosional (EQ) adalah kemampuan untuk mengenali, memahami, dan mengelola emosi diri sendiri, serta mengenali, memahami, dan memengaruhi emosi orang lain. Di sekolah, EQ membantu Anda dalam banyak hal: mengelola stres ujian, bekerja sama dalam kelompok, menyelesaikan konflik dengan teman, dan membangun hubungan yang baik dengan guru. Siswa dengan EQ tinggi cenderung lebih termotivasi, tangguh, dan memiliki kemampuan komunikasi yang lebih baik. Melatih EQ dapat dimulai dengan hal sederhana: saat merasa marah atau sedih, coba beri nama emosi itu dan pikirkan apa pemicunya. Ini adalah langkah pertama menuju pengelolaan emosi yang lebih baik.</p></div>` }
            ],
            infoUniversitas: [
                { id: 1, name: "Universitas Indonesia (UI)", description: "Salah satu universitas riset atau institusi akademik terkemuka di dunia.", majors: [{ name: "Ilmu Komputer", desc: "Mempelajari tentang komputasi, perangkat keras, dan perangkat lunak.", prospects: ["Software Engineer", "Data Scientist", "IT Consultant"] }, { name: "Kedokteran", desc: "Program pendidikan untuk menjadi seorang dokter profesional.", prospects: ["Dokter Umum", "Dokter Spesialis", "Peneliti Medis"] }, { name: "Hukum", desc: "Mempelajari sistem hukum dan perundang-undangan.", prospects: ["Pengacara", "Notaris", "Jaksa", "Legal Corporate"] }] },
                { id: 2, name: "Institut Teknologi Bandung (ITB)", description: "Sekolah tinggi teknik pertama di Indonesia yang berfokus pada sains, teknik, dan seni.", majors: [{ name: "Teknik Informatika", desc: "Berfokus pada pengembangan solusi komputasi yang inovatif.", prospects: ["Full-stack Developer", "AI Engineer", "Cybersecurity Analyst"] }, { name: "Arsitektur", desc: "Mempelajari perancangan bangunan dan lingkungan binaan.", prospects: ["Arsitek", "Urban Planner", "Interior Designer"] }, { name: "Desain Komunikasi Visual (DKV)", desc: "Mempelajari cara menyampaikan pesan melalui elemen visual.", prospects: ["Graphic Designer", "UI/UX Designer", "Illustrator", "Animator"] } ] },
                { id: 3, name: "Universitas Gadjah Mada (UGM)", description: "Universitas negeri di Indonesia yang berpusat di Yogyakarta, dikenal dengan keragaman ilmunya.", majors: [{ name: "Psikologi", desc: "Mempelajari perilaku dan proses mental manusia.", prospects: ["Psikolog Klinis", "HRD Specialist", "Konselor"] }, { name: "Ilmu Komunikasi", desc: "Fokus pada proses komunikasi efektif di berbagai media.", prospects: ["Public Relations", "Jurnalis", "Digital Strategist"] }, { name: "Kehutanan", desc: "Mengkaji pengelolaan dan konservasi ekosistem hutan.", prospects: ["Manajer Konservasi", "Analis Lingkungan", "Pengusaha Agroforestri"] } ] },
                { id: 4, name: "IPB University (IPB)", description: "Dahulu Institut Pertanian Bogor, kini menjadi perguruan tinggi inovatif berbasis riset.", majors: [{ name: "Agribisnis", desc: "Menggabungkan ilmu pertanian dengan manajemen bisnis.", prospects: ["Manajer Perkebunan", "Analis Pasar Komoditas", "Pengusaha Agribisnis"] }, { name: "Teknologi Pangan", desc: "Mempelajari proses pengolahan bahan pangan menjadi produk yang aman dan bergizi.", prospects: ["Quality Control Pangan", "R&D Food Product", "Ahli Gizi Industri"] }, { name: "Kedokteran Hewan", desc: "Program pendidikan untuk menjadi dokter hewan profesional.", prospects: ["Dokter Hewan Praktik", "Peneliti Vaksin", "Ahli Kesehatan Satwa Liar"] } ] }
            ],
            tipsJurusan: { title: 'Tips Cerdas Memilih Jurusan Kuliah', content: `<div class="prose"><h3>1. Kenali Diri Anda Terlebih Dahulu (Self-Assessment)</h3><p>Ini adalah langkah paling fundamental. Sebelum melihat keluar, lihatlah ke dalam. Tanyakan pada diri sendiri:</p><ul><li><strong>Apa Minat Anda?</strong> Pelajaran apa yang paling Anda nikmati di sekolah? Topik apa yang suka Anda baca atau tonton di waktu luang?</li><li><strong>Apa Bakat Anda?</strong> Di bidang apa Anda secara alami lebih unggul? Apakah Anda pandai berhitung, menulis, menggambar, atau berkomunikasi dengan orang lain?</li><li><strong>Apa Tipe Kepribadian Anda?</strong> Apakah Anda seorang introvert yang nyaman bekerja sendiri, atau ekstrovert yang bersemangat dalam tim? Gunakan hasil dari Pusat Asesmen di aplikasi ini!</li><li><strong>Apa Nilai-Nilai Hidup Anda?</strong> Apakah Anda ingin pekerjaan yang memberikan stabilitas finansial, membantu banyak orang, atau memberikan kebebasan kreatif?</li></ul><h3>2. Lakukan Riset Jurusan dan Karier</h3><p>Setelah mengenali diri sendiri, mulailah riset mendalam. Jangan hanya terpaku pada nama jurusan yang populer.</p><ul><li><strong>Kurikulum:</strong> Pelajari mata kuliah apa saja yang akan Anda ambil di jurusan tersebut. Apakah terlihat menarik?</li><li><strong>Prospek Karier:</strong> Cari tahu profesi apa saja yang bisa ditekuni oleh lulusan jurusan tersebut. Apakah sesuai dengan gaya hidup yang Anda inginkan?</li><li><strong>Kunjungi Pameran Pendidikan:</strong> Manfaatkan acara seperti Campus Expo untuk bertanya langsung kepada perwakilan universitas.</li></ul><h3>3. Pertimbangkan Realitas</h3><p>Minat dan bakat itu penting, tetapi jangan abaikan faktor realistis.</p><ul><li><strong>Kemampuan Akademik:</strong> Sesuaikan pilihan Anda dengan nilai dan kemampuan akademik Anda.</li><li><strong>Biaya Pendidikan:</strong> Diskusikan dengan orang tua mengenai kemampuan finansial dan cari informasi beasiswa jika diperlukan.</li><li><strong>Lokasi Kampus:</strong> Apakah Anda siap untuk merantau atau lebih nyaman kuliah di kota sendiri?</li></ul><h3>4. Jangan Terpengaruh Secara Berlebihan</h3><p>Sangat baik untuk mendengarkan masukan, tetapi keputusan akhir ada di tangan Anda.</p><ul><li><strong>Hindari Ikut-ikutan Teman:</strong> Apa yang cocok untuk teman Anda belum tentu cocok untuk Anda.</li><li><strong>Kelola Ekspektasi Orang Tua:</strong> Ajak orang tua berdiskusi dengan baik. Tunjukkan hasil riset Anda dan jelaskan alasan logis di balik pilihan Anda.</li></ul><p>Memilih jurusan adalah maraton, bukan sprint. Nikmati prosesnya, lakukan riset dengan teliti, dan yang terpenting, percayalah pada diri sendiri. Gunakan semua fitur di ForCons untuk membantu Anda mengambil keputusan terbaik!</p></div>`},
            jalurMasukPTN: { title: 'Panduan Lengkap Jalur Masuk PTN', content: `<div class="prose"><h3>1. SNBP (Seleksi Nasional Berdasarkan Prestasi)</h3><p>SNBP adalah jalur seleksi yang berfokus pada prestasi akademik siswa selama di SMA/sederajat. Penilaian utama adalah nilai rapor dari semester 1 hingga 5, serta prestasi non-akademik lainnya yang relevan.</p><ul><li><strong>Siapa yang Bisa Ikut?</strong> Hanya siswa yang dinyatakan 'eligible' oleh sekolahnya berdasarkan akreditasi sekolah.</li><li><strong>Strategi:</strong> Konsisten menjaga nilai rapor tetap tinggi, aktif di organisasi atau lomba untuk menambah portofolio prestasi.</li><li><strong>Penting:</strong> Pemilihan jurusan di SNBP harus sangat strategis. Pilihlah jurusan yang benar-benar sesuai minat dan selaras dengan rekam jejak akademik Anda, karena sekali diterima di jalur ini, Anda tidak bisa mendaftar di jalur SNBT atau Mandiri di tahun yang sama.</li></ul><div class="percentage-box"><p>Estimasi Persentase Diterima: <strong>~20% dari total kuota PTN.</strong> Jalur ini sangat kompetitif.</p></div><h3>2. SNBT (Seleksi Nasional Berdasarkan Tes)</h3><p>SNBT adalah jalur seleksi yang menggunakan Ujian Tulis Berbasis Komputer (UTBK) sebagai dasar penilaian utama. Semua siswa lulusan 3 tahun terakhir bisa mendaftar.</p><ul><li><strong>Materi Tes:</strong> Fokus pada Tes Potensi Skolastik (TPS) yang mengukur kemampuan kognitif, penalaran matematika, serta literasi dalam Bahasa Indonesia dan Bahasa Inggris.</li><li><strong>Strategi:</strong> Latihan soal UTBK tahun-tahun sebelumnya secara rutin. Pahami tipe soal dan manajemen waktu saat ujian. Ikut bimbingan belajar atau try out bisa sangat membantu.</li><li><strong>Penting:</strong> Tidak ada penilaian rapor di sini. Kesempatan Anda murni ditentukan oleh skor UTBK yang Anda peroleh.</li></ul><div class="percentage-box"><p>Estimasi Persentase Diterima: <strong>~40% dari total kuota PTN.</strong> Ini adalah jalur dengan kuota terbesar.</p></div><h3>3. Jalur Mandiri</h3><p>Jalur Mandiri diselenggarakan oleh masing-masing PTN setelah pengumuman SNBT. Setiap universitas memiliki mekanisme, materi tes, dan jadwal yang berbeda-beda.</p><ul><li><strong>Jenis Seleksi:</strong> Bisa berupa ujian tulis mandiri, penggunaan nilai UTBK, penilaian prestasi, atau kombinasi dari semuanya.</li><li><strong>Strategi:</strong> Pantau terus website resmi PTN incaran Anda. Pelajari secara spesifik jenis seleksi yang mereka gunakan. Persiapkan diri sesuai dengan materi yang akan diujikan.</li><li><strong>Penting:</strong> Jalur ini seringkali memerlukan biaya pendaftaran dan Uang Kuliah Tunggal (UKT) yang lebih tinggi. Pastikan untuk mendiskusikannya dengan orang tua.</li></ul><div class="percentage-box"><p>Estimasi Persentase Diterima: <strong>~30% - 40% dari total kuota PTN.</strong> Kuota bisa bervariasi antar universitas.</p></div></div>` },
            infoPTS: { title: 'Panduan Masuk Perguruan Tinggi Swasta (PTS)', content: `<div class="prose"><h3>Kenapa Memilih PTS?</h3><p>Perguruan Tinggi Swasta (PTS) seringkali menjadi alternatif yang sangat berkualitas. Banyak PTS di Indonesia memiliki akreditasi unggul, fasilitas modern, kurikulum yang relevan dengan industri, dan jaringan alumni yang kuat. Jangan ragu untuk menjadikan PTS sebagai pilihan utama.</p><h3>Hal Penting yang Harus Diperhatikan:</h3><ul><li><strong>Akreditasi:</strong> Pastikan universitas dan jurusan yang Anda tuju memiliki akreditasi yang baik (idealnya A atau Unggul) dari BAN-PT. Akreditasi ini penting untuk masa depan karier Anda.</li><li><strong>Jalur Pendaftaran:</strong> PTS umumnya memiliki lebih banyak jalur pendaftaran yang fleksibel, seperti jalur rapor, jalur tes, jalur prestasi, dan bahkan pendaftaran yang buka hampir sepanjang tahun.</li><li><strong>Biaya Kuliah:</strong> Pahami struktur biaya secara detail, mulai dari uang pangkal (uang gedung), biaya per semester (UKT/SKS), hingga biaya praktikum. Tanyakan juga mengenai program beasiswa atau cicilan yang tersedia.</li><li><strong>Fasilitas dan Lingkungan:</strong> Cari tahu tentang fasilitas yang ditawarkan, seperti laboratorium, perpustakaan, unit kegiatan mahasiswa (UKM), dan lingkungan kampus. Jika memungkinkan, lakukan kunjungan langsung.</li><li><strong>Kerja Sama Industri:</strong> PTS yang baik biasanya memiliki hubungan erat dengan dunia industri, yang akan memudahkan mahasiswanya dalam program magang dan penempatan kerja setelah lulus.</li></ul></div>` },
            infoUniversitasSwasta: [
                { id: 1, name: "Binus University", description: "Dikenal dengan program IT dan bisnisnya yang kuat serta program magang 3+1.", majors: [{ name: "Teknik Informatika", desc: "Salah satu program IT terbaik di Indonesia dengan fokus pada inovasi digital.", prospects: ["Software Developer", "Game Developer", "Startup Founder"] }, { name: "Manajemen", desc: "Program bisnis dengan berbagai konsentrasi seperti pemasaran digital dan keuangan.", prospects: ["Brand Manager", "Financial Analyst", "Business Consultant"] }] },
                { id: 2, name: "Telkom University", description: "Unggul dalam bidang telekomunikasi, informatika, dan industri kreatif.", majors: [{ name: "Sistem Informasi", desc: "Menggabungkan ilmu komputer dengan manajemen untuk menciptakan solusi bisnis berbasis teknologi.", prospects: ["IT Project Manager", "System Analyst", "Database Administrator"] }, { name: "Ilmu Komunikasi", desc: "Fokus pada komunikasi strategis di era digital.", prospects: ["Corporate Communication", "Content Creator", "Media Planner"] }] }
            ],
            // === DATA TES BARU ===
            testGayaBelajar: { /* ... sama seperti sebelumnya ... */ },
            testKepribadian: { /* ... sama seperti sebelumnya ... */ },
            aptitudeTest: { /* ... sama seperti sebelumnya ... */ }
        };
        mockData.testGayaBelajar = { title: "Tes Gaya Belajar (VARK)", description: "Tes ini membantu Anda memahami cara terbaik Anda dalam menyerap informasi. Apakah Anda seorang pembelajar Visual, Auditori, Read/Write, atau Kinestetik?", questions: [ { q: "Ketika saya merakit sesuatu, saya paling suka...", o: { V: "Mengikuti diagram atau gambar.", A: "Mendengarkan instruksi dari seseorang.", R: "Membaca petunjuk manual terlebih dahulu.", K: "Langsung mencoba dan mempraktikkannya." } }, { q: "Saya paling mudah mengingat sesuatu jika...", o: { V: "Saya melihatnya dalam bentuk grafik atau peta pikiran.", A: "Saya mendiskusikannya dengan orang lain.", R: "Saya menuliskannya dalam bentuk catatan.", K: "Saya melakukannya secara langsung (misal: eksperimen)." } }, { q: "Saat belajar topik baru, saya lebih suka...", o: { V: "Menonton video dokumenter.", A: "Mendengarkan podcast atau ceramah.", R: "Membaca buku atau artikel mendalam.", K: "Mengikuti workshop atau simulasi." } } ], results: { V: { type: "Visual", rec: "Anda belajar paling baik melalui gambar, diagram, video, dan demonstrasi visual. Gunakan peta pikiran (mind map) dan stabilo berwarna saat membuat catatan." }, A: { type: "Auditori", rec: "Anda belajar paling baik melalui pendengaran. Diskusi kelompok, mendengarkan penjelasan guru, dan merekam materi untuk didengarkan kembali akan sangat membantu Anda." }, R: { type: "Read/Write", rec: "Anda belajar paling baik melalui tulisan. Membuat catatan yang detail, membaca buku teks, dan menyusun ringkasan adalah metode yang paling efektif untuk Anda." }, K: { type: "Kinestetik", rec: "Anda belajar paling baik melalui praktik dan pengalaman langsung. Simulasi, studi kasus, eksperimen, dan belajar sambil bergerak akan memaksimalkan pemahaman Anda." } } };
        mockData.testKepribadian = { title: "Tes Kepribadian (MBTI Sederhana)", description: "Tes ini memberikan gambaran tentang tipe kepribadian Anda, membantu Anda memahami preferensi dan kekuatan alami Anda.", questions: [ { q: "Setelah seharian beraktivitas dengan banyak orang, saya merasa...", o: { E: "Berenergi dan bersemangat.", I: "Lelah dan butuh waktu sendiri untuk 'mengisi ulang'." } }, { q: "Saat mengambil keputusan, saya lebih mengandalkan...", o: { T: "Logika, data, dan objektivitas.", F: "Perasaan, nilai-nilai pribadi, dan dampaknya pada orang lain." } }, { q: "Saya lebih suka...", o: { S: "Fokus pada detail yang nyata dan apa yang ada saat ini.", N: "Melihat gambaran besar dan memikirkan berbagai kemungkinan di masa depan." } }, { q: "Dalam mengerjakan tugas, saya cenderung...", o: { J: "Membuat rencana yang terstruktur dan menyelesaikannya sebelum tenggat waktu.", P: "Lebih fleksibel, suka menunda, dan bekerja baik di bawah tekanan waktu." } } ], results: { "E": "Ekstrovert: Anda mendapatkan energi dari interaksi sosial.", "I": "Introvert: Anda mendapatkan energi dari waktu menyendiri.", "T": "Thinking: Anda membuat keputusan berdasarkan logika.", "F": "Feeling: Anda membuat keputusan berdasarkan perasaan dan nilai.", "S": "Sensing: Anda fokus pada fakta dan kenyataan.", "N": "Intuition: Anda fokus pada ide dan kemungkinan.", "J": "Judging: Anda suka keteraturan dan perencanaan.", "P": "Perceiving: Anda suka fleksibilitas dan spontanitas." } };
        mockData.aptitudeTest = { title: "Tes Minat Bakat (RIASEC)", description: "Tes ini membantu memetakan minat Anda ke dalam enam area kepribadian/pekerjaan untuk memberikan rekomendasi karier yang sesuai.", questions: [ { q: "Saat ada waktu luang, saya lebih suka...", a: "Membongkar dan merakit barang elektronik.", b: "Membaca buku atau menulis cerita.", c: "Membantu teman menyelesaikan masalahnya.", d: "Menggambar atau mendesain sesuatu." }, { q: "Saya paling tertarik dengan pelajaran...", a: "Matematika atau Fisika.", b: "Bahasa Indonesia atau Sejarah.", c: "Bimbingan Konseling atau Sosiologi.", d: "Seni Budaya atau Prakarya." }, { q: "Jika bekerja dalam kelompok, peran saya biasanya...", a: "Menganalisis data dan mencari solusi logis.", b: "Menyusun laporan dan presentasi.", c: "Menengahi jika ada konflik.", d: "Memberikan ide-ide kreatif dan visual." } ], results: { A: { type: "Realistis & Investigatif", rec: "Anda kuat dalam bidang yang butuh logika, analisis, dan skill teknis.", majors: ["Teknik Informatika", "Kedokteran"], careers: ["Software Engineer"] }, B: { type: "Konvensional & Enterprising", rec: "Anda menikmati kegiatan terkait bahasa, komunikasi, data, dan punya potensi kepemimpinan.", majors: ["Manajemen Bisnis"], careers: ["Digital Marketer"] }, C: { type: "Sosial", rec: "Anda punya empati tinggi, suka membantu orang, dan pandai berkomunikasi.", majors: ["Psikologi"], careers: ["Content Creator"] }, D: { type: "Artistik", rec: "Anda punya jiwa seni tinggi, imajinatif, dan suka berekspresi melalui karya.", majors: ["Desain Komunikasi Visual"], careers: ["UI/UX Designer"] } } };
        
        // === TEMPLATING & RENDERING ENGINE ===
        function getPageHTML(pageId) { return getDynamicPageHTML(pageId) || `<div class="page active flex items-center justify-center min-h-screen">Halaman tidak ditemukan.</div>`; }
        function getDynamicPageHTML(pageId) {
            const pages = {
                'login-page': { isFullScreen: true, content: `<div class="w-full max-w-md p-8 space-y-8 bg-white rounded-xl shadow-lg"><div class="text-center"><i data-lucide="compass" class="mx-auto h-12 w-12 text-indigo-600"></i><h1 class="text-3xl font-bold text-slate-900 mt-4">ForCons</h1><p class="mt-2 text-sm text-slate-600">BK SMANIDA disini selalu siap membantu</p></div><div class="flex border-b border-slate-200"><button id="student-tab-btn" class="flex-1 py-2 text-sm font-medium text-center text-indigo-600 border-b-2 border-indigo-600">Siswa</button><button id="admin-tab-btn" class="flex-1 py-2 text-sm font-medium text-center text-slate-500">Admin</button><button id="super-admin-tab-btn" class="flex-1 py-2 text-sm font-medium text-center text-slate-500">Super Admin</button></div><div id="student-login-form"><form class="mt-8 space-y-6" onsubmit="event.preventDefault(); login('siswa');"><input id="student-username" type="text" required class="w-full px-4 py-3 border border-slate-300 rounded-lg" placeholder="Username"><input id="student-password" type="password" required class="w-full px-4 py-3 border border-slate-300 rounded-lg" placeholder="Password"><p id="student-login-error" class="text-red-500 text-sm hidden">Username atau password salah.</p><button type="submit" class="w-full btn-primary">Masuk</button></form></div><div id="admin-login-form" class="hidden"><form class="mt-8 space-y-6" onsubmit="event.preventDefault(); login('admin');"><input id="admin-username" type="text" required class="w-full px-4 py-3 border" placeholder="Username Admin"><input id="admin-password" type="password" required class="w-full px-4 py-3 border" placeholder="Password Admin"><p id="admin-login-error" class="text-red-500 text-sm hidden">Username atau password salah.</p><button type="submit" class="w-full btn-primary">Masuk sebagai Admin</button></form></div><div id="super-admin-login-form" class="hidden"><form class="mt-8 space-y-6" onsubmit="event.preventDefault(); login('superadmin');"><input id="super-admin-username" type="text" required class="w-full px-4 py-3 border" placeholder="Username Super Admin"><input id="super-admin-password" type="password" required class="w-full px-4 py-3 border" placeholder="Password Super Admin"><p id="super-admin-login-error" class="text-red-500 text-sm hidden">Username atau password salah.</p><button type="submit" class="w-full btn-primary">Masuk Super Admin</button></form></div></div>` },
                'student-dashboard': { header: () => studentHeader(), title: 'Dashboard', content: `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${dashboardCard('pusat-asesmen-page', 'clipboard-check', 'indigo', 'Pusat Asesmen', 'Kenali diri melalui berbagai tes psikologis.')}${dashboardCard('materi-bk-page', 'book-open', 'green', 'Materi BK', 'Pelajari topik konseling & info universitas.')}${dashboardCard('appointment-hub-page', 'calendar-plus', 'blue', 'Janji Temu', 'Atur & lihat jadwal konsultasi Anda.')}${dashboardCard('chat-page', 'message-circle', 'purple', 'Konsultasi Langsung', 'Chat dengan konselor via aplikasi.')}${dashboardCard('articles-page', 'file-text', 'red', 'Artikel Motivasi', 'Baca artikel inspiratif pengembangan diri.')}${dashboardCard('events-page', 'calendar', 'yellow', 'Notifikasi Acara', 'Jangan lewatkan seminar karier & pameran.')}</div>` },
                'admin-dashboard': { header: () => adminHeader(), title: 'Dashboard Admin', content: `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${dashboardCardAdmin('admin-manage-appointments-page', 'calendar-check', 'blue', 'Lihat Janji Temu', 'Kelola jadwal konsultasi siswa.')}${dashboardCardAdmin('admin-manage-users-page', 'users', 'slate', 'Kelola Akun Siswa', 'Tambah atau hapus akun siswa.')}${dashboardCardAdmin('admin-manage-chat', 'messages-square', 'purple', 'Live Chat Konseling', 'Balas pesan dari siswa.', getUnreadMessageCount())}${dashboardCardAdmin('admin-manage-articles', 'file-plus-2', 'red', 'Kelola Artikel', 'Tambah, edit, atau hapus artikel.')}${dashboardCardAdmin('admin-manage-events', 'calendar-plus', 'teal', 'Kelola Acara', 'Publikasikan informasi seminar.')}${dashboardCardAdmin('admin-manage-tips-page', 'edit', 'orange', 'Kelola Tips Jurusan', 'Ubah konten tips memilih jurusan.')}${dashboardCardAdmin('admin-manage-jalur-ptn-page', 'landmark', 'cyan', 'Kelola Jalur PTN', 'Edit info SNBP, SNBT, Mandiri.')}${dashboardCardAdmin('admin-manage-info-pts-page', 'building', 'pink', 'Kelola Info PTS', 'Edit info universitas swasta.')}</div>` },
                'super-admin-dashboard': { header: () => superAdminHeader(), title: 'Dashboard Super Admin', content: `<div class="grid grid-cols-1 md:grid-cols-2 gap-6">${dashboardCardAdmin('super-admin-manage-admins-page', 'shield-plus', 'rose', 'Kelola Akun Admin', 'Tambah, hapus, atau ubah data admin.')}${dashboardCardAdmin('super-admin-manage-users-page', 'users-2', 'sky', 'Kelola Akun Siswa', 'Tambah, hapus, atau ubah data siswa.')}</div>` },
                'super-admin-manage-admins-page': { header: () => superAdminHeader('super-admin-dashboard'), title: 'Kelola Akun Admin', button: `<button onclick="openAdminForm()" class="btn-primary flex items-center gap-2"><i data-lucide="user-plus" class="h-5 w-5"></i>Tambah Admin</button>`, content: `<div id="super-admin-admins-list" class="space-y-4">${renderSuperAdminAdmins()}</div>` },
                'super-admin-manage-users-page': { header: () => superAdminHeader('super-admin-dashboard'), title: 'Kelola Akun Siswa', button: `<button onclick="openUserForm()" class="btn-primary flex items-center gap-2"><i data-lucide="user-plus" class="h-5 w-5"></i>Tambah Siswa</button>`, content: `<div id="super-admin-users-list" class="space-y-4">${renderSuperAdminUsers()}</div>` },
                'materi-bk-page': { header: () => studentHeader('student-dashboard'), title: 'Materi Bimbingan Konseling', content: `<div class="grid grid-cols-1 md:grid-cols-2 gap-6">${dashboardCard('materi-konsultasi-page', 'heart-handshake', 'rose', 'Materi Konsultasi', 'Tips & trik mengatasi masalah belajar dan pribadi.')}${dashboardCard('tips-jurusan-page', 'graduation-cap', 'lime', 'Tips Memilih Jurusan', 'Panduan cerdas memilih program studi.')}${dashboardCard('jalur-ptn-page', 'landmark', 'cyan', 'Info Jalur Masuk PTN', 'Pahami SNBP, SNBT, dan Jalur Mandiri.')}${dashboardCard('info-ptn-page', 'school', 'sky', 'Info Universitas Negeri (PTN)', 'Eksplorasi pilihan kampus negeri.')}${dashboardCard('info-pts-page', 'building', 'pink', 'Info Universitas Swasta (PTS)', 'Temukan kampus swasta berkualitas.')}</div>` },
                'materi-konsultasi-page': { header: () => studentHeader('materi-bk-page'), title: 'Materi Konsultasi', content: `<div class="space-y-4">${mockData.materiKonsultasi.map(m => `<div class="card cursor-pointer" onclick="openMateriModal('${m.title}', '${m.content.replace(/'/g, "\\'")}')"><h3 class="text-lg font-bold text-rose-700">${m.title}</h3><p class="text-slate-600 mt-2">${m.summary}</p></div>`).join('')}</div>` },
                'info-ptn-page': { header: () => studentHeader('materi-bk-page'), title: 'Info Universitas Negeri (PTN)', content: `<div class="space-y-4">${renderUniversities(mockData.infoUniversitas)}</div>` },
                'info-pts-page': { header: () => studentHeader('materi-bk-page'), title: 'Info Universitas Swasta (PTS)', content: () => `${mockData.infoPTS.content}<div class="mt-8 space-y-4">${renderUniversities(mockData.infoUniversitasSwasta)}</div>` },
                'chat-page': { header: () => studentHeader('student-dashboard'), title: 'Konsultasi Langsung', content: getChatInterfaceHTML('siswa') },
                'admin-manage-chat': { header: () => adminHeader('admin-dashboard'), title: 'Live Chat Konseling', content: getChatInterfaceHTML('admin') },
                'articles-page': { header: () => studentHeader('student-dashboard'), title: 'Artikel Motivasi', content: `<div class="space-y-4">${mockData.articles.map(article => `<div class="card"><h3 class="text-lg font-bold text-red-700">${article.title}</h3><p class="text-slate-600 mt-2">${article.content}</p><button onclick="openArticleModal('${article.title}', '${article.fullContent.replace(/'/g, "\\'")}')" class="text-sm text-indigo-600 hover:underline mt-4 font-semibold">Baca Selengkapnya...</button></div>`).join('') || `<p class="text-slate-500">Belum ada artikel.</p>`}</div>`},
                'events-page': { header: () => studentHeader('student-dashboard'), title: 'Notifikasi Acara', content: () => `<div class="space-y-4">${mockData.events.map(event => `<div class="card"><div class="flex justify-between items-start gap-4"><div><h3 class="text-lg font-bold text-teal-700">${event.title}</h3><p class="text-sm text-slate-500 mt-1 flex items-center flex-wrap"><i data-lucide="calendar" class="h-4 w-4 mr-1.5"></i>${new Date(event.date).toLocaleDateString('id-ID',{day:'numeric',month:'long',year:'numeric'})}<span class="mx-2 hidden sm:inline">|</span><i data-lucide="map-pin" class="h-4 w-4 mr-1.5 mt-1 sm:mt-0 sm:ml-2"></i>${event.location}</p><p class="text-slate-600 mt-2">${event.description}</p></div><button onclick="registerEvent(this, ${event.id})" class="text-sm bg-slate-200 hover:bg-slate-300 font-semibold py-2 px-4 rounded-lg flex-shrink-0" ${currentUser && event.registrants.includes(currentUser.username) ? 'disabled' : ''}>${currentUser && event.registrants.includes(currentUser.username) ? 'Terdaftar' : 'Daftar'}</button></div></div>`).join('') || `<p class="text-slate-500">Belum ada acara.</p>`}</div>` },
                'admin-manage-articles': { header: () => adminHeader('admin-dashboard'), title: 'Kelola Artikel', button: `<button onclick="openArticleForm()" class="btn-primary flex items-center gap-2"><i data-lucide="plus-circle" class="h-5 w-5"></i>Tambah Artikel</button>`, content: `<div id="admin-article-list" class="space-y-4">${renderAdminArticles()}</div>`},
                'admin-manage-events': { header: () => adminHeader('admin-dashboard'), title: 'Kelola Acara', button: `<button onclick="openEventForm()" class="btn-primary flex items-center gap-2"><i data-lucide="plus-circle" class="h-5 w-5"></i>Tambah Acara</button>`, content: `<div id="admin-event-list" class="space-y-4">${renderAdminEvents()}</div>`},
                'appointment-hub-page': { header: () => studentHeader('student-dashboard'), title: 'Pusat Janji Temu', content: () => renderAppointmentHub() },
                'admin-manage-appointments-page': { header: () => adminHeader('admin-dashboard'), title: 'Daftar Janji Temu', content: renderAppointments() },
                'admin-manage-users-page': { header: () => adminHeader('admin-dashboard'), title: 'Kelola Akun Siswa', button: `<button onclick="openUserForm()" class="btn-primary flex items-center gap-2"><i data-lucide="user-plus" class="h-5 w-5"></i>Tambah Akun</button>`, content: `<div id="admin-user-list" class="space-y-4">${renderAdminUsers()}</div>` },
                'pusat-asesmen-page': { header: () => studentHeader('student-dashboard'), title: 'Pusat Asesmen', content: () => `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${renderTestCard('test-gaya-belajar-page', 'paint-brush', 'cyan', mockData.testGayaBelajar.title, mockData.testGayaBelajar.description)}${renderTestCard('test-kepribadian-page', 'users', 'amber', mockData.testKepribadian.title, mockData.testKepribadian.description)}${renderTestCard('aptitude-test-page', 'briefcase', 'violet', mockData.aptitudeTest.title, mockData.aptitudeTest.description)}</div>` },
                'test-gaya-belajar-page': { header: () => studentHeader('pusat-asesmen-page'), title: () => mockData.testGayaBelajar.title, content: () => renderTestPage('gaya-belajar', mockData.testGayaBelajar) },
                'test-kepribadian-page': { header: () => studentHeader('pusat-asesmen-page'), title: () => mockData.testKepribadian.title, content: () => renderTestPage('kepribadian', mockData.testKepribadian) },
                'aptitude-test-page': { header: () => studentHeader('pusat-asesmen-page'), title: () => mockData.aptitudeTest.title, content: () => renderTestPage('aptitude', mockData.aptitudeTest) },
                'tips-jurusan-page': { header: () => studentHeader('materi-bk-page'), title: () => mockData.tipsJurusan.title, content: () => `<div class="card">${mockData.tipsJurusan.content}</div>` },
                'jalur-ptn-page': { header: () => studentHeader('materi-bk-page'), title: () => mockData.jalurMasukPTN.title, content: () => `<div class="card">${mockData.jalurMasukPTN.content}</div>` },
                'admin-manage-tips-page': { header: () => adminHeader('admin-dashboard'), title: 'Kelola Tips Memilih Jurusan', content: `<div class="card"><div id="tips-content-preview">${mockData.tipsJurusan.content}</div><div class="text-right mt-6"><button onclick="openTipsJurusanForm()" class="btn-primary">Edit Konten</button></div></div>` },
                'admin-manage-jalur-ptn-page': { header: () => adminHeader('admin-dashboard'), title: 'Kelola Konten Jalur Masuk PTN', content: `<div class="card"><div id="jalur-ptn-preview">${mockData.jalurMasukPTN.content}</div><div class="text-right mt-6"><button onclick="openJalurPTNForm()" class="btn-primary">Edit Konten</button></div></div>` },
                'admin-manage-info-pts-page': { header: () => adminHeader('admin-dashboard'), title: 'Kelola Konten Info PTS', content: `<div class="card"><div id="info-pts-preview">${mockData.infoPTS.content}</div><div class="text-right mt-6"><button onclick="openInfoPTSForm()" class="btn-primary">Edit Konten</button></div></div>` }
            };
            const pageData = pages[pageId];
            if (!pageData) return null;
            const contentHTML = typeof pageData.content === 'function' ? pageData.content() : pageData.content;
            if (pageData.isFullScreen) return `<div class="page active flex items-center justify-center h-full bg-slate-50">${contentHTML}</div>`;
            const headerHTML = typeof pageData.header === 'function' ? pageData.header() : pageData.header;
            const buttonHTML = typeof pageData.button === 'function' ? pageData.button() : (pageData.button || '');
            const titleHTML = typeof pageData.title === 'function' ? pageData.title() : pageData.title;
            return `<div class="page active">${headerHTML}<main class="px-4 py-6 md:px-8 md:py-8">${titleHTML ? `<div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold">${titleHTML}</h2>${buttonHTML}</div>` : ''}${contentHTML}</main></div>`;
        }
        function studentHeader(backPage) { return `<header class="bg-white shadow-sm p-4 flex justify-between items-center sticky top-0 z-20"><div class="flex items-center space-x-3"><i data-lucide="compass" class="h-8 w-8 text-indigo-600"></i><h1 class="text-xl font-bold">ForCons</h1></div>${backPage ? `<button onclick="showPage('${backPage}')" class="flex items-center space-x-2 text-sm text-slate-600 hover:text-indigo-600"><i data-lucide="arrow-left" class="h-4 w-4"></i><span>Kembali</span></button>` : `<span class="font-medium">Halo, ${currentUser ? currentUser.username : ''}!</span>`}<button onclick="logout()" class="flex items-center space-x-2 text-sm text-slate-600 hover:text-indigo-600"><i data-lucide="log-out" class="h-4 w-4"></i><span>Keluar</span></button></header>`; }
        function adminHeader(backPage) { return `<header class="bg-white shadow-sm p-4 flex justify-between items-center sticky top-0 z-20"><div class="flex items-center space-x-3"><i data-lucide="shield-check" class="h-8 w-8 text-indigo-600"></i><h1 class="text-xl font-bold">Admin Panel</h1></div>${backPage ? `<button onclick="showPage('${backPage}')" class="flex items-center space-x-2 text-sm text-slate-600 hover:text-indigo-600"><i data-lucide="arrow-left" class="h-4 w-4"></i><span>Kembali</span></button>` : ''}<button onclick="logout()" class="flex items-center space-x-2 text-sm text-slate-600 hover:text-indigo-600"><i data-lucide="log-out" class="h-4 w-4"></i><span>Keluar</span></button></header>`; }
        function superAdminHeader(backPage) { return `<header class="bg-rose-600 text-white shadow-sm p-4 flex justify-between items-center sticky top-0 z-20"><div class="flex items-center space-x-3"><i data-lucide="gem" class="h-8 w-8"></i><h1 class="text-xl font-bold">Super Admin</h1></div>${backPage ? `<button onclick="showPage('${backPage}')" class="flex items-center space-x-2 text-sm hover:text-rose-200"><i data-lucide="arrow-left" class="h-4 w-4"></i><span>Kembali</span></button>` : ''}<button onclick="logout()" class="flex items-center space-x-2 text-sm hover:text-rose-200"><i data-lucide="log-out" class="h-4 w-4"></i><span>Keluar</span></button></header>`; }
        const dashboardCard = (page, icon, color, title, desc) => `<div onclick="showPage('${page}')" class="card cursor-pointer"><i data-lucide="${icon}" class="h-10 w-10 text-${color}-500 mb-4"></i><h3 class="text-lg font-bold mb-2">${title}</h3><p class="text-sm text-slate-600">${desc}</p></div>`;
        const dashboardCardAdmin = (page, icon, color, title, desc, count = 0) => `<div onclick="showPage('${page}')" class="card cursor-pointer relative"><i data-lucide="${icon}" class="h-10 w-10 text-${color}-500 mb-4"></i><h3 class="text-lg font-bold mb-2">${title}</h3><p class="text-sm text-slate-600">${desc}</p>${count > 0 ? `<div class="absolute top-4 right-4 bg-red-500 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center">${count}</div>` : ''}</div>`;
        function renderPage() { document.getElementById('app-container').innerHTML = getPageHTML(activePage); lucide.createIcons(); addEventListenersForPage(activePage); const chatBox = document.getElementById('chat-box-messages'); if (chatBox) chatBox.scrollTop = chatBox.scrollHeight; }
        function showPage(pageId) { activePage = pageId; if(pageId === 'admin-manage-chat') markMessagesAsRead(); renderPage(); }
        function addEventListenersForPage(pageId) {
            if (pageId === 'login-page') { 
                const tabs = {
                    student: { btn: document.getElementById('student-tab-btn'), form: document.getElementById('student-login-form') },
                    admin: { btn: document.getElementById('admin-tab-btn'), form: document.getElementById('admin-login-form') },
                    superadmin: { btn: document.getElementById('super-admin-tab-btn'), form: document.getElementById('super-admin-login-form') }
                };
                const switchTab = (activeKey) => {
                    Object.keys(tabs).forEach(key => {
                        const isActive = key === activeKey;
                        tabs[key].btn.classList.toggle('text-indigo-600', isActive);
                        tabs[key].btn.classList.toggle('border-indigo-600', isActive);
                        tabs[key].btn.classList.toggle('text-slate-500', !isActive);
                        tabs[key].form.classList.toggle('hidden', !isActive);
                    });
                };
                tabs.student.btn.addEventListener('click', () => switchTab('student'));
                tabs.admin.btn.addEventListener('click', () => switchTab('admin'));
                tabs.superadmin.btn.addEventListener('click', () => switchTab('superadmin'));
            }
            if (pageId.includes('test-')) { document.getElementById('test-form').addEventListener('submit', e => { e.preventDefault(); submitTest(e.target); }); }
            if (pageId === 'info-ptn-page' || pageId === 'info-pts-page') { document.querySelectorAll('[data-accordion-trigger]').forEach(trigger => { trigger.addEventListener('click', () => { const content = trigger.parentElement; content.dataset.state = content.dataset.state === 'open' ? 'closed' : 'open'; trigger.querySelector('i').classList.toggle('rotate-180'); }); }); }
        }
        function login(userType) {
            if (userType === 'siswa') {
                const username = document.getElementById('student-username').value; const pass = document.getElementById('student-password').value;
                const errorEl = document.getElementById('student-login-error');
                const user = mockData.users.find(u => u.username === username && u.password === pass);
                if (user) { errorEl.classList.add('hidden'); currentUser = user; showPage('student-dashboard'); } else { errorEl.classList.remove('hidden'); }
            } else if (userType === 'admin') {
                const username = document.getElementById('admin-username').value; const pass = document.getElementById('admin-password').value;
                const errorEl = document.getElementById('admin-login-error');
                const admin = mockData.admins.find(a => a.username === username && a.password === pass);
                if (admin) { errorEl.classList.add('hidden'); currentUser = {username: 'Admin', role: 'admin'}; showPage('admin-dashboard'); } else { errorEl.classList.remove('hidden'); }
            } else if (userType === 'superadmin') {
                const username = document.getElementById('super-admin-username').value; const pass = document.getElementById('super-admin-password').value;
                const errorEl = document.getElementById('super-admin-login-error');
                if (username === mockData.superAdminCredentials.username && pass === mockData.superAdminCredentials.password) { errorEl.classList.add('hidden'); currentUser = {username: 'Super Admin', role: 'superadmin'}; showPage('super-admin-dashboard'); } else { errorEl.classList.remove('hidden'); }
            }
        }
        function logout() { currentUser = null; showPage('login-page'); }
        function renderUniversities(uniList) { return uniList.map(uni => `<div class="card" data-state="closed"><button data-accordion-trigger class="w-full flex justify-between items-center text-left"><span class="font-bold text-sky-800 text-lg">${uni.name}</span><i data-lucide="chevron-down" class="transition-transform"></i></button><div class="pt-4 mt-4 border-t border-slate-200 space-y-3"><p class="text-slate-600 mb-4">${uni.description}</p>${uni.majors.map(major => `<div class="p-3 bg-slate-50 rounded-lg"><h4 class="font-semibold text-slate-800">${major.name}</h4><p class="text-sm text-slate-500 mt-1">${major.desc}</p><div class="mt-3"><h5 class="text-xs font-bold text-slate-400 mb-2">PROSPEK KARIER</h5><div class="flex flex-wrap gap-2">${major.prospects.map(p => `<span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded-full">${p}</span>`).join('')}</div></div></div>`).join('')}</div></div>`).join(''); }
        function openMateriModal(title, content) { document.getElementById('modal-form-title').textContent = title; document.getElementById('modal-form-content').innerHTML = ''; document.getElementById('modal-body').insertAdjacentHTML('afterbegin', `<div class="prose max-w-none text-slate-600 leading-relaxed">${content}</div>`); document.getElementById('form-modal').classList.remove('hidden'); }
        function renderAppointmentHub() {
            const form = `<div class="card max-w-lg mx-auto"><h3 class="text-xl font-bold mb-4">Buat Janji Temu Baru</h3><form onsubmit="event.preventDefault(); saveAppointment(this);"><div class="space-y-4"><label class="block"><span>Tanggal Konsultasi</span><input type="date" name="date" class="mt-1 block w-full rounded-md border-slate-300" required></label><label class="block"><span>Waktu</span><input type="time" name="time" class="mt-1 block w-full rounded-md border-slate-300" required></label><label class="block"><span>Topik yang Ingin Dibahas</span><textarea name="topic" class="mt-1 block w-full rounded-md border-slate-300" rows="3" required placeholder="Contoh: Bingung memilih jurusan antara Psikologi dan Komunikasi"></textarea></label><div class="text-right"><button type="submit" class="btn-primary">Buat Janji</button></div></div></form></div>`;
            const userAppointments = mockData.appointments.filter(a => a.student === currentUser.username);
            let history = `<div class="mt-8"><h3 class="text-xl font-bold mb-4">Riwayat Janji Temu Anda</h3>`;
            if (userAppointments.length === 0) {
                history += `<p class="text-center text-slate-500 card">Anda belum pernah membuat janji temu.</p>`;
            } else {
                history += `<div class="space-y-4">${userAppointments.map(a => {
                    let statusClass, statusText;
                    switch(a.status) {
                        case 'accepted': statusClass = 'bg-green-100 text-green-800'; statusText = 'Diterima'; break;
                        case 'declined': statusClass = 'bg-red-100 text-red-800'; statusText = 'Ditolak'; break;
                        default: statusClass = 'bg-yellow-100 text-yellow-800'; statusText = 'Menunggu Persetujuan';
                    }
                    const waLink = `https://wa.me/6281388464385?text=${encodeURIComponent(`Halo, saya ${currentUser.username}. Mengenai janji temu saya pada tanggal ${a.date} jam ${a.time} yang telah ${statusText}, saya ingin menanyakan langkah selanjutnya. Terima kasih.`)}`;
                    return `<div class="card"><div class="flex justify-between items-center"><div><p class="font-semibold">${a.topic}</p><p class="text-sm text-slate-500">${a.date} Pukul ${a.time}</p></div><span class="text-xs font-medium py-1 px-3 rounded-full ${statusClass}">${statusText}</span></div>${a.status !== 'pending' ? `<div class="mt-4 pt-4 border-t text-right"><a href="${waLink}" target="_blank" class="btn-primary btn-whatsapp text-sm py-2 px-4 inline-flex items-center gap-2"><i data-lucide="message-circle"></i> Hubungi Guru BK</a></div>` : ''}</div>`;
                }).join('')}</div>`;
            }
            history += `</div>`;
            return form + history;
        }
        function renderAppointments() { if (mockData.appointments.length === 0) return `<p class="text-center text-slate-500">Belum ada janji temu yang dibuat.</p>`; return `<div class="overflow-x-auto"><table class="min-w-full bg-white rounded-lg shadow"><thead class="bg-slate-50"><tr><th class="p-4 text-left text-sm font-semibold text-slate-600">Dibuat Pada</th><th class="p-4 text-left text-sm font-semibold text-slate-600">Siswa</th><th class="p-4 text-left text-sm font-semibold text-slate-600">Jadwal</th><th class="p-4 text-left text-sm font-semibold text-slate-600">Topik</th><th class="p-4 text-left text-sm font-semibold text-slate-600">Status</th><th class="p-4 text-left text-sm font-semibold text-slate-600">Aksi</th></tr></thead><tbody class="divide-y divide-slate-200">${mockData.appointments.map(a => {
            let statusClass, statusText;
            switch(a.status) {
                case 'accepted': statusClass = 'bg-green-100 text-green-800'; statusText = 'Diterima'; break;
                case 'declined': statusClass = 'bg-red-100 text-red-800'; statusText = 'Ditolak'; break;
                default: statusClass = 'bg-yellow-100 text-yellow-800'; statusText = 'Menunggu';
            }
            const actions = a.status === 'pending' ? `<div class="flex gap-2"><button onclick="updateAppointmentStatus(${a.id}, 'accepted')" class="btn-primary btn-success text-xs py-1 px-2">Terima</button><button onclick="updateAppointmentStatus(${a.id}, 'declined')" class="btn-primary btn-danger text-xs py-1 px-2">Tolak</button></div>` : '-';
            return `<tr><td class="p-4 text-sm text-slate-500">${new Date(a.createdAt).toLocaleString('id-ID')}</td><td class="p-4 font-medium">${a.student}</td><td class="p-4">${a.date} @ ${a.time}</td><td class="p-4">${a.topic}</td><td class="p-4"><span class="text-xs font-medium py-1 px-3 rounded-full ${statusClass}">${statusText}</span></td><td class="p-4">${actions}</td></tr>`
        }).join('')}</tbody></table></div>`; }
        function renderTestCard(page, icon, color, title, desc) { const result = currentUser.testResults[page]; return `<div class="card ${result ? 'bg-green-50' : ''}"><div class="flex justify-between items-start"><div><i data-lucide="${icon}" class="h-10 w-10 text-${color}-500 mb-4"></i><h3 class="text-lg font-bold mb-2">${title}</h3><p class="text-sm text-slate-600">${desc}</p></div>${result ? `<div class="text-xs font-bold text-green-700 bg-green-200 py-1 px-2 rounded-full">Selesai</div>` : ''}</div>${result ? `<div class="mt-4 pt-4 border-t"><p class="font-semibold text-sm">Hasil Anda: <span class="font-normal text-green-800">${result}</span></p></div>` : ''}<button onclick="showPage('${page}')" class="btn-primary mt-4 w-full">${result ? 'Lihat Detail / Ulangi Tes' : 'Mulai Tes'}</button></div>`; }
        function renderTestPage(type, testData) { const userResult = currentUser.testResults[`${type}-page`]; const formHTML = `<form id="test-form" data-test-type="${type}"><p class="mb-6 text-slate-600">${testData.description}</p>${testData.questions.map((item, index) => `<div class="card mb-4"><p class="font-semibold text-slate-700 mb-3">${index+1}. ${item.q}</p><div class="space-y-3">${Object.entries(item.o || item).filter(([k]) => k !== 'q').map(([key, val]) => `<div><label class="flex items-center cursor-pointer"><input type="radio" name="q${index}" value="${key.toUpperCase()}" class="mr-3" required> ${val}</label></div>`).join('')}</div></div>`).join('')}<button type="submit" class="btn-primary mt-2">Lihat Hasil</button></form>`; const resultHTML = userResult ? `<div class="card bg-indigo-50 border-indigo-200">${renderTestResult(type, userResult)}</div>` : ''; return resultHTML + formHTML; }
        function saveAppointment(form) { const data = Object.fromEntries(new FormData(form)); const newAppointment = { id: Date.now(), student: currentUser.username, ...data, status: 'pending', createdAt: new Date() }; mockData.appointments.push(newAppointment); if (!currentUser.appointments) currentUser.appointments = []; currentUser.appointments.push(newAppointment); showToast('Janji temu berhasil dibuat!'); showPage('appointment-hub-page'); }
        function updateAppointmentStatus(id, newStatus) { const appointment = mockData.appointments.find(a => a.id === id); if (appointment) { appointment.status = newStatus; showToast(`Janji temu telah ${newStatus === 'accepted' ? 'diterima' : 'ditolak'}.`); renderPage(); } }
        function openRegistrantsModal(eventId) { const event = mockData.events.find(e => e.id === eventId); const title = `Pendaftar: ${event.title}`; const content = event.registrants.length > 0 ? `<ul class="list-disc list-inside">${event.registrants.map(r => `<li>${r}</li>`).join('')}</ul>` : '<p>Belum ada pendaftar.</p>'; openMateriModal(title, content); }
        function registerEvent(button, eventId) { const event = mockData.events.find(e => e.id === eventId); event.registrants.push(currentUser.username); button.textContent = 'Terdaftar'; button.disabled = true; showToast('Anda berhasil mendaftar!'); }
        function submitTest(form) {
            const type = form.dataset.testType; const formData = new FormData(form);
            const answers = {}; let resultKey;
            for (let value of formData.values()) { answers[value] = (answers[value] || 0) + 1; }
            if(type === 'gaya-belajar') { resultKey = Object.keys(answers).reduce((a, b) => answers[a] > answers[b] ? a : b); currentUser.testResults['test-gaya-belajar-page'] = mockData.testGayaBelajar.results[resultKey].type; } 
            else if (type === 'kepribadian') { const results = []; for (const [key, value] of formData.entries()) { results.push(value); } resultKey = results.join(''); currentUser.testResults['test-kepribadian-page'] = resultKey; } 
            else if (type === 'aptitude') { resultKey = Object.keys(answers).reduce((a, b) => answers[a] > answers[b] ? a : b); currentUser.testResults['aptitude-test-page'] = mockData.aptitudeTest.results[resultKey].type; }
            renderPage();
        }
        function renderTestResult(type, resultKey) {
            if (type === 'gaya-belajar') { const resultData = Object.values(mockData.testGayaBelajar.results).find(r => r.type === resultKey); return `<h3>Hasil Tes: Gaya Belajar ${resultData.type}</h3><p>${resultData.rec}</p>`; } 
            else if (type === 'kepribadian') { const personality = resultKey.split('').map((char) => mockData.testKepribadian.results[char]).join(', '); return `<h3>Hasil Tes: Tipe Kepribadian Anda adalah ${resultKey}</h3><p>Ini berarti Anda memiliki preferensi untuk: ${personality}. Tipe ini menunjukkan kekuatan Anda dalam...</p>`; } 
            else if (type === 'aptitude') { const resultData = Object.values(mockData.aptitudeTest.results).find(r => r.type === resultKey); return `<h3>Hasil Tes: Tipe Minat ${resultData.type}</h3><p>${resultData.rec}</p>`; }
            return '';
        }
        function openTipsJurusanForm() { openFormModal('Edit Tips Memilih Jurusan', `<div class="space-y-4"><label class="block"><span>Judul</span><input type="text" name="title" class="mt-1 block w-full" value="${mockData.tipsJurusan.title}" required></label><label class="block"><span>Isi Konten (HTML)</span><textarea name="content" class="mt-1 block w-full" rows="10" required>${mockData.tipsJurusan.content}</textarea></label><div class="text-right"><button type="submit" class="btn-primary">Simpan Perubahan</button></div></div>`, saveTipsJurusan); }
        function saveTipsJurusan(form) { const data = Object.fromEntries(new FormData(form)); mockData.tipsJurusan.title = data.title; mockData.tipsJurusan.content = data.content; showToast('Konten tips berhasil diperbarui.'); closeFormModal(); renderPage(); }
        function openJalurPTNForm() { openFormModal('Edit Konten Jalur Masuk PTN', `<div class="space-y-4"><label class="block"><span>Judul</span><input type="text" name="title" class="mt-1 block w-full" value="${mockData.jalurMasukPTN.title}" required></label><label class="block"><span>Isi Konten (HTML)</span><textarea name="content" class="mt-1 block w-full" rows="10" required>${mockData.jalurMasukPTN.content}</textarea></label><div class="text-right"><button type="submit" class="btn-primary">Simpan Perubahan</button></div></div>`, saveJalurPTN); }
        function saveJalurPTN(form) { const data = Object.fromEntries(new FormData(form)); mockData.jalurMasukPTN.title = data.title; mockData.jalurMasukPTN.content = data.content; showToast('Konten Jalur PTN berhasil diperbarui.'); closeFormModal(); renderPage(); }
        function openInfoPTSForm() { openFormModal('Edit Konten Info PTS', `<div class="space-y-4"><label class="block"><span>Judul</span><input type="text" name="title" class="mt-1 block w-full" value="${mockData.infoPTS.title}" required></label><label class="block"><span>Isi Konten (HTML)</span><textarea name="content" class="mt-1 block w-full" rows="10" required>${mockData.infoPTS.content}</textarea></label><div class="text-right"><button type="submit" class="btn-primary">Simpan Perubahan</button></div></div>`, saveInfoPTS); }
        function saveInfoPTS(form) { const data = Object.fromEntries(new FormData(form)); mockData.infoPTS.title = data.title; mockData.infoPTS.content = data.content; showToast('Konten Info PTS berhasil diperbarui.'); closeFormModal(); renderPage(); }
        function getUnreadMessageCount() { return mockData.chatMessages.filter(m => m.sender === 'siswa' && !m.read).length; }
        function markMessagesAsRead() { mockData.chatMessages.forEach(m => { if(m.sender === 'siswa') m.read = true; }); }
        function sendMessage(senderType) { const input = document.getElementById('chat-input'); if (input.value.trim()) { mockData.chatMessages.push({ id: Date.now(), sender: senderType, text: input.value.trim(), timestamp: new Date(), read: senderType === 'admin' }); input.value = ''; renderPage(); } }
        function getChatInterfaceHTML(senderType) {
            const waContacts = senderType === 'siswa' ? `<div class="p-3 bg-slate-100 rounded-lg mb-4 text-center text-sm"><p class="font-semibold mb-2">Butuh Respon Cepat? Hubungi Guru BK Langsung:</p><div class="flex justify-center gap-4">${renderWACardMini('Pak Rohman', '+6281388464385')}${renderWACardMini('Pak Gofar', '+6283147559807')}</div></div>` : '';
            const bubbles = mockData.chatMessages.map(msg => { const isUser = msg.sender === senderType; const time = msg.timestamp.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }); return isUser ? `<div class="flex justify-end items-end gap-2"><div class="text-xs text-slate-400">${time}</div><div class="bg-indigo-500 text-white p-3 rounded-lg max-w-xs"><p class="text-sm">${msg.text}</p></div></div>` : `<div class="flex justify-start items-end gap-2"><div class="bg-slate-200 p-3 rounded-lg max-w-xs"><p class="text-sm">${msg.text}</p></div><div class="text-xs text-slate-400">${time}</div></div>`; }).join(''); return `<div class="card">${waContacts}<div id="chat-box-messages" class="h-96 border rounded-lg p-4 flex flex-col gap-4 overflow-y-auto bg-slate-50 chat-box">${bubbles}</div><div class="mt-4 flex"><input id="chat-input" type="text" placeholder="Ketik pesanmu..." class="w-full px-4 py-2 border border-slate-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"><button onclick="sendMessage('${senderType}')" class="bg-indigo-600 text-white px-4 py-2 rounded-r-lg hover:bg-indigo-700 flex-shrink-0">Kirim</button></div></div>`; 
        }
        function renderWACardMini(name, number) { const formattedNumber = number.replace('+62', '62'); return `<a href="https://wa.me/${formattedNumber}" target="_blank" class="btn-primary btn-whatsapp py-2 px-3 inline-flex items-center gap-2 text-xs"><i data-lucide="message-circle"></i> Chat ${name}</a>`; }
        function renderAdminArticles() { return mockData.articles.map(a => `<div class="card flex justify-between items-center"><div><p class="font-semibold">${a.title}</p></div><div class="flex gap-2">${editButton('Article', a.id)}${deleteButton('Article', a.id)}</div></div>`).join('') || `<p class="text-slate-500 text-center py-4">Belum ada artikel.</p>`; }
        function openArticleForm(id = null) { currentEditingId = id; const a = id ? mockData.articles.find(i => i.id === id) : { title: '', content: '', fullContent: '' }; openFormModal(id ? 'Edit Artikel' : 'Tambah Artikel', `<div class="space-y-4"><label class="block"><span>Judul</span><input type="text" name="title" class="mt-1 block w-full rounded-md border-slate-300" value="${a.title}" required></label><label class="block"><span>Ringkasan</span><textarea name="content" class="mt-1 block w-full rounded-md border-slate-300" rows="2" required>${a.content}</textarea></label><label class="block"><span>Isi Lengkap (Boleh menggunakan HTML)</span><textarea name="fullContent" class="mt-1 block w-full rounded-md border-slate-300" rows="5" required>${a.fullContent}</textarea></label><div class="text-right"><button type="submit" class="btn-primary">Simpan</button></div></div>`, saveArticle); }
        function saveArticle(form) { const data = Object.fromEntries(new FormData(form)); if (currentEditingId) { const index = mockData.articles.findIndex(a => a.id === currentEditingId); mockData.articles[index] = { ...mockData.articles[index], ...data }; showToast('Artikel diperbarui'); } else { mockData.articles.push({ id: Date.now(), ...data }); showToast('Artikel ditambahkan'); } document.getElementById('admin-article-list').innerHTML = renderAdminArticles(); lucide.createIcons(); closeFormModal(); }
        function deleteArticle(id) { openConfirmModal('Konfirmasi Hapus Artikel', 'Yakin ingin menghapus artikel ini?', () => { mockData.articles = mockData.articles.filter(a => a.id !== id); document.getElementById('admin-article-list').innerHTML = renderAdminArticles(); lucide.createIcons(); showToast('Artikel dihapus'); }); }
        function renderAdminEvents() { return mockData.events.map(e => `<div class="card flex justify-between items-center"><div><p class="font-semibold">${e.title}</p><p class="text-sm text-slate-500">${new Date(e.date).toLocaleDateString('id-ID',{day:'numeric',month:'long',year:'numeric'})}</p></div><div class="flex gap-2"><button onclick="openRegistrantsModal(${e.id})" class="text-slate-500 hover:text-blue-600 p-2"><i data-lucide="users" class="h-5 w-5"></i></button>${editButton('Event', e.id)}${deleteButton('Event', e.id)}</div></div>`).join('') || `<p class="text-slate-500 text-center py-4">Belum ada acara.</p>`; }
        function openEventForm(id = null) { currentEditingId = id; const e = id ? mockData.events.find(i => i.id === id) : { title: '', date: '', location: '', description: '' }; openFormModal(id ? 'Edit Acara' : 'Tambah Acara', `<div class="space-y-4"><label class="block"><span>Nama Acara</span><input type="text" name="title" class="mt-1 block w-full" value="${e.title}" required></label><label class="block"><span>Tanggal</span><input type="date" name="date" class="mt-1 block w-full" value="${e.date}" required></label><label class="block"><span>Lokasi</span><input type="text" name="location" class="mt-1 block w-full" value="${e.location}" required></label><label class="block"><span>Deskripsi</span><textarea name="description" class="mt-1 block w-full" rows="3" required>${e.description}</textarea></label><div class="text-right"><button type="submit" class="btn-primary">Simpan</button></div></div>`, saveEvent); }
        function saveEvent(form) { const data = Object.fromEntries(new FormData(form)); if (currentEditingId) { const index = mockData.events.findIndex(e => e.id === currentEditingId); mockData.events[index] = { ...mockData.events[index], ...data }; showToast('Acara diperbarui'); } else { mockData.events.push({ id: Date.now(), ...data, registrants: [] }); showToast('Acara ditambahkan'); } document.getElementById('admin-event-list').innerHTML = renderAdminEvents(); lucide.createIcons(); closeFormModal(); }
        function deleteEvent(id) { openConfirmModal('Konfirmasi Hapus Acara', 'Yakin ingin menghapus acara ini?', () => { mockData.events = mockData.events.filter(e => e.id !== id); document.getElementById('admin-event-list').innerHTML = renderAdminEvents(); lucide.createIcons(); showToast('Acara dihapus'); }); }
        function renderAdminUsers() { return mockData.users.map(user => `<div class="card flex justify-between items-center"><div><p class="font-semibold">${user.username}</p></div><div class="flex gap-2">${deleteButton('User', `'${user.username}'`)}</div></div>`).join('') || `<p class="text-slate-500 text-center py-4">Belum ada akun siswa.</p>`; }
        function openUserForm() { openFormModal('Tambah Akun Siswa', `<div class="space-y-4"><p id="user-form-error" class="text-red-500 text-sm hidden"></p><label class="block"><span>Username</span><input type="text" name="username" class="mt-1 block w-full rounded-md border-slate-300" required></label><label class="block"><span>Password</span><input type="password" name="password" class="mt-1 block w-full rounded-md border-slate-300" required></label><div class="text-right"><button type="submit" class="btn-primary">Simpan Akun</button></div></div>`, saveUser); }
        function saveUser(form) { const username = form.username.value; const password = form.password.value; const errorEl = document.getElementById('user-form-error'); if (mockData.users.some(u => u.username === username)) { errorEl.textContent = 'Username sudah digunakan.'; errorEl.classList.remove('hidden'); } else { mockData.users.push({ username, password, testResults: {}, appointments: [] }); showToast('Akun siswa berhasil ditambahkan.'); const targetList = currentUser.role === 'superadmin' ? 'super-admin-users-list' : 'admin-user-list'; document.getElementById(targetList).innerHTML = currentUser.role === 'superadmin' ? renderSuperAdminUsers() : renderAdminUsers(); lucide.createIcons(); closeFormModal(); } }
        function deleteUser(username) { openConfirmModal('Konfirmasi Hapus Akun', `Yakin ingin menghapus akun siswa "${username}"? Tindakan ini tidak dapat diurungkan.`, () => { mockData.users = mockData.users.filter(user => user.username !== username); const targetList = currentUser.role === 'superadmin' ? 'super-admin-users-list' : 'admin-user-list'; document.getElementById(targetList).innerHTML = currentUser.role === 'superadmin' ? renderSuperAdminUsers() : renderAdminUsers(); lucide.createIcons(); showToast('Akun siswa berhasil dihapus.'); }); }
        const editButton = (type, id) => `<button onclick="open${type}Form(${id})" class="text-slate-500 hover:text-indigo-600 p-2"><i data-lucide="edit" class="h-5 w-5"></i></button>`;
        const passwordButton = (type, username) => `<button onclick="openChangePasswordForm('${type}', '${username}')" class="text-slate-500 hover:text-amber-600 p-2"><i data-lucide="key-round" class="h-5 w-5"></i></button>`;
        const deleteButton = (type, id) => `<button onclick="delete${type}(${id})" class="text-slate-500 hover:text-red-600 p-2"><i data-lucide="trash-2" class="h-5 w-5"></i></button>`;
        function renderSuperAdminAdmins() { return mockData.admins.map(admin => `<div class="card flex justify-between items-center"><div><p class="font-semibold">${admin.username}</p></div><div class="flex gap-2">${passwordButton('admin', admin.username)}${deleteButton('Admin', `'${admin.username}'`)}</div></div>`).join('') || `<p class="text-slate-500 text-center py-4">Belum ada akun admin.</p>`;}
        function renderSuperAdminUsers() { return mockData.users.map(user => `<div class="card flex justify-between items-center"><div><p class="font-semibold">${user.username}</p></div><div class="flex gap-2">${passwordButton('user', user.username)}${deleteButton('User', `'${user.username}'`)}</div></div>`).join('') || `<p class="text-slate-500 text-center py-4">Belum ada akun siswa.</p>`; }
        function openAdminForm() { openFormModal('Tambah Akun Admin', `<div class="space-y-4"><p id="admin-form-error" class="text-red-500 text-sm hidden"></p><label class="block"><span>Username</span><input type="text" name="username" class="mt-1 block w-full rounded-md border-slate-300" required></label><label class="block"><span>Password</span><input type="password" name="password" class="mt-1 block w-full rounded-md border-slate-300" required></label><div class="text-right"><button type="submit" class="btn-primary">Simpan Akun</button></div></div>`, saveAdmin); }
        function saveAdmin(form) { const username = form.username.value; const password = form.password.value; const errorEl = document.getElementById('admin-form-error'); if (mockData.admins.some(a => a.username === username)) { errorEl.textContent = 'Username sudah digunakan.'; errorEl.classList.remove('hidden'); } else { mockData.admins.push({ username, password }); showToast('Akun admin berhasil ditambahkan.'); document.getElementById('super-admin-admins-list').innerHTML = renderSuperAdminAdmins(); lucide.createIcons(); closeFormModal(); } }
        function deleteAdmin(username) { openConfirmModal('Konfirmasi Hapus Akun', `Yakin ingin menghapus akun admin "${username}"?`, () => { mockData.admins = mockData.admins.filter(admin => admin.username !== username); document.getElementById('super-admin-admins-list').innerHTML = renderSuperAdminAdmins(); lucide.createIcons(); showToast('Akun admin berhasil dihapus.'); }); }
        function openChangePasswordForm(userType, username) { openFormModal(`Ganti Password untuk ${username}`, `<div class="space-y-4"><input type="hidden" name="username" value="${username}"><input type="hidden" name="userType" value="${userType}"><label class="block"><span>Password Baru</span><input type="password" name="password" class="mt-1 block w-full rounded-md border-slate-300" required></label><div class="text-right"><button type="submit" class="btn-primary">Simpan Password</button></div></div>`, savePassword); }
        function savePassword(form) { const { username, userType, password } = Object.fromEntries(new FormData(form)); const userList = userType === 'admin' ? mockData.admins : mockData.users; const user = userList.find(u => u.username === username); if (user) { user.password = password; showToast(`Password untuk ${username} berhasil diubah.`); closeFormModal(); } else { showToast('Gagal mengubah password: user tidak ditemukan.'); } }
        function openFormModal(title, contentHTML, submitHandler) { document.getElementById('modal-form-title').textContent = title; const form = document.getElementById('modal-form-content'); form.innerHTML = contentHTML; form.onsubmit = (e) => { e.preventDefault(); submitHandler(form); }; document.getElementById('modal-body').firstChild.replaceWith(form); document.getElementById('form-modal').classList.remove('hidden'); lucide.createIcons(); }
        function closeFormModal() { document.getElementById('form-modal').classList.add('hidden'); currentEditingId = null; document.getElementById('modal-body').innerHTML = '<form id="modal-form-content"></form>'; }
        function openConfirmModal(title, message, onConfirmCallback) { const modal = document.getElementById('confirm-modal'); document.getElementById('confirm-modal-title').textContent = title; document.getElementById('confirm-modal-message').textContent = message; const confirmBtn = document.getElementById('confirm-modal-confirm'); const cancelBtn = document.getElementById('confirm-modal-cancel'); const newConfirmBtn = confirmBtn.cloneNode(true); confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn); newConfirmBtn.onclick = () => { onConfirmCallback(); closeConfirmModal(); }; cancelBtn.onclick = () => closeConfirmModal(); modal.classList.remove('hidden'); lucide.createIcons(); }
        function closeConfirmModal() { document.getElementById('confirm-modal').classList.add('hidden'); }
        function openArticleModal(title, content) { openMateriModal(title, content) }
        let toastTimeout;
        function showToast(message) { const toast = document.getElementById('toast-notification'); document.getElementById('toast-message').textContent = message; toast.classList.add('show'); clearTimeout(toastTimeout); toastTimeout = setTimeout(() => { toast.classList.remove('show'); }, 3000); }
        document.addEventListener('DOMContentLoaded', renderPage);
    </script>
</body>
</html>
